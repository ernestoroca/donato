<!DOCTYPE html>
<html>
<head>
<title>W3.CSS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
<style>
.boton{
  padding: 15px;
  text-align: center;
}
.pantalla{
  padding: 15px;
  text-align: center;
}
#btn-del{
  padding: 15px;
  text-align: center;
}
#btn-OK{
  padding: 15px;
  text-align: center;
}
</style>
</head>
<body>
<div id="feliz" class="w3-modal w3-animate-zoom">
  <div class="w3-modal-content">
    <div class="w3-container">
      <img src="feliz.jpg" style="width:100%">
    </div>
  </div>
</div>
<div id="triste" class="w3-modal w3-animate-zoom">
  <div class="w3-modal-content">
    <div class="w3-container">
      <img src="triste.jpg" style="width:100%">
      <p id="triste-mensaje" class="w3-jumbo w3-center w3-text-red"></p>
    </div>
  </div>
</div>
<div id="empezar" class="w3-modal w3-animate-zoom">
  <div class="w3-modal-content">
    <div class="w3-container">
      <br>
      <img id="empezar-img" src="https://media.giphy.com/media/QJvwBSGaoc4eI/giphy.gif" style="width:100%">
      <p id="empezar-mensaje" class="w3-xxlarge w3-center w3-text-red">Toca la pantalla para empezar</p>
    </div>
  </div>
</div>
<div class="w3-row">
  <div class="w3-col s12 pantalla w3-border w3-pale-green w3-xxlarge" id="pregunta">1+1</div>
</div>
<div class="w3-row">
  <div class="w3-col s12 pantalla w3-border w3-pale-yellow w3-xxlarge" id="respuesta">2</div>
</div>
<hr>
<div class="w3-row w3-xxlarge">
  <div class="w3-col s4 boton w3-light-grey" id="btn1">1</div>
  <div class="w3-col s4 boton w3-grey" id="btn2">2</div>
  <div class="w3-col s4 boton w3-light-grey" id="btn3">3</div>
</div>
<div class="w3-row w3-xxlarge">
  <div class="w3-col s4 boton w3-grey" id="btn4">4</div>
  <div class="w3-col s4 boton w3-light-grey" id="btn5">5</div>
  <div class="w3-col s4 boton w3-grey" id="btn6">6</div>
</div>
<div class="w3-row w3-xxlarge">
  <div class="w3-col s4 boton w3-light-grey" id="btn7">7</div>
  <div class="w3-col s4 boton w3-grey" id="btn8">8</div>
  <div class="w3-col s4 boton w3-light-grey" id="btn9">9</div>
</div>
<div class="w3-row w3-xxlarge">
  <div class="w3-col s4 w3-sand" id="btn-del"><<</div>
  <div class="w3-col s4 boton w3-light-grey" id="btn0">0</div>
  <div class="w3-col s4 w3-green" id="btn-OK">OK</div>
</div>
<script>
var vecPreguntas,vecRespuestas,vecNiveles;
var reloj;
var nroEjercicios,nroErrores;


function reset(){
  vecPreguntas = [];
  vecRespuestas = [];
  vecNiveles = [];
  var a,b;
  //suma
  for (a=0;a<10;a++){
    for (b=0;b<10;b++){
      vecPreguntas.push(""+b+"+"+a);
      vecRespuestas.push(a+b);
      vecNiveles.push(10);
    }
  }
  //resta
  for (a=0;a<10;a++){
    for (b=0;b<10;b++){
      vecPreguntas.push(""+(b+a)+"-"+a);
      vecRespuestas.push(b);
      vecNiveles.push(10);
    }
  }
  guardaTodo();
  iniciar();
}

function guardaTodo(){
  localStorage.vecNiveles=JSON.stringify(vecNiveles);
  localStorage.vecPreguntas=JSON.stringify(vecPreguntas);
  localStorage.vecRespuestas=JSON.stringify(vecRespuestas);
}

function iniciar(){
  if (!localStorage.vecNiveles){
    reset();
  } else {
    vecNiveles = JSON.parse(localStorage.vecNiveles);
    vecPreguntas = JSON.parse(localStorage.vecPreguntas);
    vecRespuestas = JSON.parse(localStorage.vecRespuestas);
  }
  nroEjercicios=20;
  document.getElementById('empezar').style.display='block';
}

function empezar(){
  nroEjercicios=20;
  nroErrores=0;
  document.getElementById('empezar').style.display='none';
  preguntar();
}

function numeroclick() {
  var pantalla = document.getElementById("respuesta");
  var anterior = pantalla.innerHTML;
  var actual = this.id.substring(3,4);
  if (anterior=="&nbsp;"){
    anterior="0";
  }
  var nuevo = parseInt(anterior)*10+parseInt(actual);
  pantalla.innerHTML = ""+nuevo;
}

function retro(){
  var pantalla = document.getElementById("respuesta");
  var anterior = pantalla.innerHTML;
  if (anterior.length==1){
    pantalla.innerHTML = "&nbsp;";
  } else {
    var numero = parseInt(anterior);
    numero = Math.floor(numero/10);
    pantalla.innerHTML = ""+numero;
  }
}

function evaluar(){
  var numero,respuesta,pregunta,pos;
  if (reloj){
    clearTimeout(reloj);
  }
  respuesta = document.getElementById("respuesta").innerHTML;
  if (respuesta=="&nbsp;"){
    numero=10000;
  } else if (respuesta=="31416"){
    reset();
    return;
  }
  numero = parseInt(respuesta);
  
  pregunta = document.getElementById("pregunta").innerHTML;
  pos = vecPreguntas.indexOf(pregunta);
  if (vecRespuestas[pos]===numero){
    celebrar(pos);
  } else {
    entristecer(pos);
  }
}

function celebrar(pos){
  document.getElementById('feliz').style.display='block';
  vecNiveles[pos]--;
  setTimeout(function(){
     document.getElementById('feliz').style.display='none';
    preguntar();
  },2000);
}

function entristecer(pos){
  document.getElementById('triste').style.display='block';
  vecNiveles[pos]=10;
  nroErrores++;
  document.getElementById('triste-mensaje').innerText= vecPreguntas[pos] + " = " + vecRespuestas[pos];
  setTimeout(function(){
    document.getElementById('triste').style.display='none';
    preguntar();
  },6000);
}

function preguntar(){
  if (nroEjercicios==0){
    if (nroErrores==0){
      document.getElementById('empezar-img').src = "http://i1.kym-cdn.com/photos/images/original/000/751/685/932.gif";
      document.getElementById('empezar-mensaje').innerHTML="FELICIDADES!<br>No tuviste ning&uacute;n error!<br>Presiona para continuar";
    } else if(nroErrores==1){
      document.getElementById('empezar-img').src = "http://www.reactiongifs.com/r/sbbn.gif";
      document.getElementById('empezar-mensaje').innerHTML="Tuviste un error!<br>Presiona para continuar";
    } else {
      document.getElementById('empezar-img').src= "http://www.reactiongifs.com/r/sbbn.gif";
      document.getElementById('empezar-mensaje').innerHTML="Tuviste "+nroErrores+" errores!<br>Presiona para continuar";
    }
    
    document.getElementById('empezar').style.display='block';
    guardaTodo();
    return;
  }
  nroEjercicios--;
  var salto,pos,lng,repete;
  repete=3;
  do{
    salto = Math.floor(20*Math.random())+1;
    pos=0;
    lng = vecNiveles.length;
    while(salto>vecNiveles[pos]){
      salto-=vecNiveles[pos];
      pos++;
      if (pos>=lng){
        pos=lng-1;
        break;
      }
    }
    if (repete==0){
      break;
    }
    repete--;
  } while(document.getElementById("pregunta").innerHTML==vecPreguntas[pos]);
  reloj = setTimeout(evaluar,4000);
  document.getElementById("pregunta").innerHTML=vecPreguntas[pos];
  document.getElementById("respuesta").innerHTML="&nbsp;";
}

var vecBtnCls = document.getElementsByClassName("boton");
for (var i = 0; i < vecBtnCls.length; i++) {
    vecBtnCls[i].addEventListener('click', numeroclick, false);
}
document.getElementById("btn-del").addEventListener('click',retro,false);
document.getElementById("btn-OK").addEventListener('click',evaluar,false);
document.getElementById("empezar").addEventListener('click',empezar,false);
iniciar();
</script>
</body>
